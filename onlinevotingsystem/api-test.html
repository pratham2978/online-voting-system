<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Integration Test - Bharat e-Voting</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="api.js"></script>
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .btn-test {
            margin: 5px;
            padding: 8px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-test:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1><i class="fa-solid fa-flask"></i> API Integration Test</h1>
        <p>Test the backend API integration with your frontend.</p>

        <!-- Health Check -->
        <div class="test-section">
            <h3>ğŸ¥ Backend Health Check</h3>
            <button class="btn-test" onclick="testHealthCheck()">
                <i class="fa-solid fa-heartbeat"></i> Test Health
            </button>
            <div id="health-result" class="test-result"></div>
        </div>

        <!-- Admin Login Test -->
        <div class="test-section">
            <h3>ğŸ” Admin Login Test</h3>
            <button class="btn-test" onclick="testAdminLogin()">
                <i class="fa-solid fa-user-shield"></i> Test Admin Login
            </button>
            <div id="admin-login-result" class="test-result"></div>
        </div>

        <!-- Elections Test -->
        <div class="test-section">
            <h3>ğŸ—³ï¸ Elections API Test</h3>
            <button class="btn-test" onclick="testElections()">
                <i class="fa-solid fa-poll"></i> Get Elections
            </button>
            <div id="elections-result" class="test-result"></div>
        </div>

        <!-- Candidates Test -->
        <div class="test-section">
            <h3>ğŸ‘¤ Candidates API Test</h3>
            <button class="btn-test" onclick="testCandidates()">
                <i class="fa-solid fa-users"></i> Get Candidates
            </button>
            <div id="candidates-result" class="test-result"></div>
        </div>

        <!-- Voter Registration Test -->
        <div class="test-section">
            <h3>ğŸ“ Voter Registration Test</h3>
            <button class="btn-test" onclick="testVoterRegistration()">
                <i class="fa-solid fa-user-plus"></i> Test Registration
            </button>
            <div id="registration-result" class="test-result"></div>
        </div>

        <!-- Current User Status -->
        <div class="test-section">
            <h3>ğŸ‘¤ Current User Status</h3>
            <button class="btn-test" onclick="checkUserStatus()">
                <i class="fa-solid fa-info-circle"></i> Check Status
            </button>
            <div id="user-status-result" class="test-result"></div>
        </div>

        <!-- Navigation Links -->
        <div class="test-section">
            <h3>ğŸ”— Navigation</h3>
            <a href="index.html" class="btn-test">
                <i class="fa-solid fa-home"></i> Home
            </a>
            <a href="login.html" class="btn-test">
                <i class="fa-solid fa-sign-in-alt"></i> Voter Login
            </a>
            <a href="admin.html" class="btn-test">
                <i class="fa-solid fa-user-shield"></i> Admin Login
            </a>
            <a href="register.html" class="btn-test">
                <i class="fa-solid fa-user-plus"></i> Register
            </a>
        </div>
    </div>

    <script>
        // Test Health Check
        async function testHealthCheck() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'Testing...';
            
            try {
                const response = await fetch('http://localhost:5000/api/health');
                const data = await response.json();
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… SUCCESS: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ERROR: ${error.message}`;
            }
        }

        // Test Admin Login
        async function testAdminLogin() {
            const resultDiv = document.getElementById('admin-login-result');
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'Testing admin login...';
            
            try {
                const response = await auth.adminLogin('admin@bharatevoting.com', 'Admin@123');
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… ADMIN LOGIN SUCCESS: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ADMIN LOGIN ERROR: ${error.message}`;
            }
        }

        // Test Elections
        async function testElections() {
            const resultDiv = document.getElementById('elections-result');
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'Getting elections...';
            
            try {
                const response = await elections.getAll();
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… ELECTIONS SUCCESS: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ELECTIONS ERROR: ${error.message}`;
            }
        }

        // Test Candidates
        async function testCandidates() {
            const resultDiv = document.getElementById('candidates-result');
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'Getting candidates...';
            
            try {
                const response = await candidates.getAll();
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… CANDIDATES SUCCESS: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ CANDIDATES ERROR: ${error.message}`;
            }
        }

        // Test Voter Registration
        async function testVoterRegistration() {
            const resultDiv = document.getElementById('registration-result');
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'Testing registration (with sample data)...';
            
            const testVoter = {
                fullName: "Test Voter " + Math.random().toString(36).substring(7),
                dateOfBirth: "1995-01-01",
                gender: "male",
                email: "testvoter" + Math.random().toString(36).substring(7) + "@example.com",
                phoneNumber: "9" + Math.floor(Math.random() * 900000000 + 100000000),
                aadhaarNumber: "1234 5678 9012",
                address: {
                    street: "Test Street",
                    city: "Test City",
                    state: "Test State",
                    pincode: "123456"
                },
                password: "Test@123"
            };
            
            try {
                const response = await auth.register(testVoter);
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… REGISTRATION SUCCESS: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ REGISTRATION ERROR: ${error.message}`;
            }
        }

        // Check User Status
        function checkUserStatus() {
            const resultDiv = document.getElementById('user-status-result');
            
            const isAuth = utils.isAuthenticated();
            const userType = utils.getUserType();
            const userData = utils.getUserData();
            
            const status = {
                isAuthenticated: isAuth,
                userType: userType,
                userData: userData,
                token: localStorage.getItem('authToken') ? 'Present' : 'None'
            };
            
            resultDiv.className = 'test-result success';
            resultDiv.textContent = `Current Status:\n${JSON.stringify(status, null, 2)}`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('API Integration Test Page Loaded');
            checkUserStatus();
        });
    </script>
</body>
</html>